{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import { Controller } from 'stimulus'\r\n\r\nexport default class extends Controller {\r\n  static values = {\r\n    padding: Number,\r\n    targetHeight: Number,\r\n    display: String\r\n  }\r\n\r\n  initialize () {\r\n    this.element['imageGrid'] = this\r\n    Array.prototype.filter\r\n      .call(\r\n        this.element.childNodes,\r\n        node => node.nodeType == 3 && !/\\S/.test(node.nodeValue)\r\n      )\r\n      .forEach(node => node.remove())\r\n    if (!this.hasPaddingValue) this.paddingValue = 10\r\n    if (!this.hasTargetHeightValue) this.targetHeightValue = 300\r\n    if (!this.hasDisplayValue) this.displayValue = 'inline-block'\r\n    this.resizeObserver = new ResizeObserver(this.observed.bind(this))\r\n  }\r\n\r\n  observed (elements) {\r\n    this.albumWidth = elements[0].contentRect.width\r\n    this.processImages()\r\n  }\r\n\r\n  connect () {\r\n    this.resizeObserver.observe(this.element)\r\n  }\r\n\r\n  disconnect () {\r\n    this.resizeObserver.unobserve(this.element)\r\n  }\r\n\r\n  processImages () {\r\n    let row = 0\r\n    this.elements = []\r\n    this.images = Array.from(this.element.children)\r\n    this.images.forEach((ele, index) => {\r\n      const image = ele.nodeName === 'IMG' ? ele : ele.querySelector('img')\r\n      let width, height\r\n      if ('width' in image.dataset && 'height' in image.dataset) {\r\n        width = image.dataset.width\r\n        height = image.dataset.height\r\n      } else {\r\n        const comp = window.getComputedStyle(image)\r\n        width = parseFloat(comp.getPropertyValue('width').slice(0, -2))\r\n        height = parseFloat(comp.getPropertyValue('height').slice(0, -2))\r\n        image.dataset.width = width\r\n        image.dataset.height = height\r\n      }\r\n      const idealW = Math.ceil((width / height) * this.targetHeightValue)\r\n      const idealH = Math.ceil(this.targetHeightValue)\r\n      this.elements.push([ele, idealW, idealH])\r\n      row += idealW + this.paddingValue\r\n      if (row > this.albumWidth && this.elements.length) {\r\n        this.resizeRow(row - this.paddingValue)\r\n        row = 0\r\n        this.elements = []\r\n      }\r\n      if (this.images.length - 1 == index && this.elements.length) {\r\n        this.resizeRow(row)\r\n        row = 0\r\n        this.elements = []\r\n      }\r\n    }, this)\r\n  }\r\n\r\n  resizeRow (row) {\r\n    const imageExtras = this.paddingValue * (this.elements.length - 1)\r\n    const albumWidthAdjusted = this.albumWidth - imageExtras\r\n    const overPercent = albumWidthAdjusted / (row - imageExtras)\r\n    let trackWidth = imageExtras\r\n    this.elements.forEach((element, index) => {\r\n      const [ele, idealW, idealH] = element\r\n      let fw = Math.floor(idealW * overPercent)\r\n      let fh = Math.floor(idealH * overPercent)\r\n      const isNotLast = index < this.elements.length - 1\r\n      trackWidth += fw\r\n      if (!isNotLast && trackWidth < this.albumWidth)\r\n        fw += this.albumWidth - trackWidth\r\n      fw--\r\n      const image = ele.nodeName === 'IMG' ? ele : ele.querySelector('img')\r\n      image.style.width = fw + 'px'\r\n      image.style.height = fh + 'px'\r\n      ele.style.marginBottom = this.paddingValue + 'px'\r\n      ele.style.marginRight = isNotLast ? this.paddingValue + 'px' : 0\r\n      ele.style.display = this.displayValue\r\n      ele.style.verticalAlign = 'bottom'\r\n    }, this)\r\n  }\r\n}\r\n"],"names":["element","Array","prototype","filter","call","childNodes","node","nodeType","test","nodeValue","forEach","remove","hasPaddingValue","paddingValue","hasTargetHeightValue","targetHeightValue","hasDisplayValue","displayValue","resizeObserver","ResizeObserver","observed","bind","elements","albumWidth","contentRect","width","processImages","observe","unobserve","row","images","from","children","ele","index","image","nodeName","querySelector","height","dataset","comp","window","getComputedStyle","parseFloat","getPropertyValue","slice","idealW","Math","ceil","idealH","push","length","resizeRow","imageExtras","albumWidthAdjusted","overPercent","trackWidth","fw","floor","fh","isNotLast","style","marginBottom","marginRight","display","verticalAlign","Controller","padding","Number","targetHeight","String"],"mappings":"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"}